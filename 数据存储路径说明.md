# 数据存储路径说明

## 修改内容

已将程序的所有数据存储路径从系统目录修改为程序当前目录，便于打包和部署。

## 目录结构

程序运行后会在当前目录下自动创建以下文件夹：

```
EddyPusher.exe (程序主文件)
├── Config/              # 配置文件目录
│   └── users.json      # 用户账号信息
├── AppData/            # 数据存储目录
│   └── EddyPusher.db  # SQLite数据库文件
└── (其他程序文件)
```

**注意**: 使用 `AppData` 而不是 `Data` 是为了避免与源代码目录 `data` 冲突（Windows文件系统不区分大小写）。

## 修改的文件

### 1. ConfigManager (配置管理器)
**文件**: `core/configmanager.cpp`

**修改前**:
```cpp
QString defaultPath = QStandardPaths::writableLocation(QStandardPaths::DocumentsLocation) + "/EddyPusherData";
```

**修改后**:
```cpp
QString appDirPath = QCoreApplication::applicationDirPath() + "/AppData";
```

**说明**: 数据库文件现在保存在程序目录下的 `AppData` 文件夹中

### 2. UserManager (用户管理器)
**文件**: `core/usermanager.cpp`

**修改前**:
```cpp
QString path = QStandardPaths::writableLocation(QStandardPaths::AppDataLocation) + "/users.json";
```

**修改后**:
```cpp
QString configDir = QCoreApplication::applicationDirPath() + "/Config";
QString path = configDir + "/users.json";
```

**说明**: 用户配置文件现在保存在程序目录下的 `Config` 文件夹中

### 3. Main.cpp (主程序)
**文件**: `main.cpp`

**新增**: 程序启动时打印路径信息
```cpp
LOG_INFO << "程序目录: " << QCoreApplication::applicationDirPath();
LOG_INFO << "数据存储路径: " << ConfigManager::instance().dataStoragePath();
```

## 优势

### 1. 便于打包部署
- 所有数据都在程序目录下，打包时只需复制整个文件夹
- 不依赖系统特定路径，避免权限问题

### 2. 便于备份和迁移
- 数据和程序在同一位置，备份时一起复制即可
- 迁移到其他电脑时，直接复制整个文件夹即可使用

### 3. 便于多实例运行
- 可以在不同目录运行多个程序实例
- 每个实例有独立的数据库和配置

### 4. 便于调试
- 数据文件位置明确，容易查找和检查
- 启动时会在日志中显示路径信息

## 数据库文件

**位置**: `程序目录/AppData/EddyPusher.db`

**内容**:
- DetectionTask 表: 检测任务记录
- MotionLog 表: 运动数据日志

## 用户配置文件

**位置**: `程序目录/Config/users.json`

**内容**:
- 用户账号信息（用户名、密码、角色）
- 默认账号：
  - 管理员: admin / 123456
  - 操作员: op / 123

## 注意事项

1. **首次运行**: 程序会自动创建 `Config` 和 `AppData` 文件夹
2. **权限要求**: 确保程序对当前目录有读写权限
3. **数据备份**: 定期备份 `AppData` 和 `Config` 文件夹
4. **打包部署**: 打包时可以包含空的 `AppData` 和 `Config` 文件夹，或让程序自动创建
5. **旧数据迁移**: 如果之前使用过旧版本，数据库文件可能在 `C:/Users/用户名/Documents/EddyPusherData`，需要手动复制到新位置

## 日志输出示例

程序启动时会输出：
```
========================================
程序启动
程序目录: E:/Qt_Project/stream_eddy_pusher
数据存储路径: E:/Qt_Project/stream_eddy_pusher/AppData
========================================
```

## 兼容性

- ✅ Windows 系统
- ✅ 便携式部署（U盘、移动硬盘）
- ✅ 网络共享目录（需要写权限）
- ✅ 多用户环境（每个用户可以有独立的程序副本）

## 旧数据迁移

如果您之前使用过旧版本，数据库文件位于：
- 旧位置: `C:/Users/用户名/Documents/EddyPusherData/EddyPusher.db`
- 新位置: `程序目录/AppData/EddyPusher.db`

迁移步骤：
1. 关闭程序
2. 将旧数据库文件复制到新位置
3. 重新启动程序

